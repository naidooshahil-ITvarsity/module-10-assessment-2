<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Edit Contact</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: #f8fafc;
      font-family: "Poppins", sans-serif;
      padding: 30px;
    }

    h2 {
      text-align: center;
      color: #007bff;
      font-weight: 600;
      margin-bottom: 30px;
    }

    #avatarImg img {
      display: block;
      margin: 0 auto 20px auto;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    label {
      font-weight: 500;
      color: #555;
    }

    input {
      border-radius: 8px;
    }

    .btn-custom {
      border-radius: 8px;
      font-weight: 500;
    }

    .form-section {
      background: #fff;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: auto;
    }
  </style>
</head>

<body onload="getContact()">
  <div class="container">
    <h2>Edit Contact</h2>
    <div id="avatarImg"></div>
    <div class="form-section">
      <form id="editForm">
        <div class="mb-3">
          <label for="firstname">First Name</label>
          <input type="text" class="form-control" id="firstname" readonly>
        </div>
        <div class="mb-3">
          <label for="lastname">Last Name</label>
          <input type="text" class="form-control" id="lastname" readonly>
        </div>
        <div class="mb-3">
          <label for="mobile">Mobile</label>
          <input type="text" class="form-control" id="mobile" readonly>
        </div>
        <div class="mb-3">
          <label for="Email">Email</label>
          <input type="text" class="form-control" id="Email" readonly>
        </div>
        <div class="mb-3">
          <label for="avatar" id="avatarlable" hidden>Change Profile Image</label>
          <input type="file" class="form-control" id="avatar" hidden>
        </div>
        <button type="button" id="submitform" class="btn btn-success w-100 btn-custom mb-3" hidden>Submit</button>
      </form>

      <div class="d-flex justify-content-between">
        <button id="homelink" class="btn btn-outline-primary btn-custom">üè† Home</button>
        <button id="editContact" class="btn btn-warning btn-custom text-white">‚úèÔ∏è Edit</button>
        <button id="deleteContact" class="btn btn-danger btn-custom">üóëÔ∏è Delete</button>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    var id = getid();
    document.getElementById("homelink").addEventListener('click', homelink);
    document.getElementById("editContact").addEventListener('click', editContact);
    document.getElementById("submitform").addEventListener('click', submitform);
    document.getElementById("deleteContact").addEventListener('click', deleteContact);

    function getid() {
      var url = window.location.href;
      var pos = url.search("=");
      var id = url.slice(pos + 1);
      return id;
    }

    function getContact() {
      fetch(rootPath + 'controller/get-contacts/?id=' + id)
        .then(response => response.json())
        .then(data => displayOutput(data));
    }

    function homelink() {
      window.open("index.html", "_self");
    }

    function displayOutput(data) {
      avatarImg = `<img src="${rootPath}/controller/uploads/${data[0].avatar}" width="200" />`;
      document.getElementById("avatarImg").innerHTML = avatarImg;
      document.getElementById("firstname").value = data[0].firstname;
      document.getElementById("lastname").value = data[0].lastname;
      document.getElementById("mobile").value = data[0].mobile;
      document.getElementById("Email").value = data[0].email;
    }

    function editContact() {
      document.getElementById("firstname").readOnly = false;
      document.getElementById("lastname").readOnly = false;
      document.getElementById("mobile").readOnly = false;
      document.getElementById("Email").readOnly = false;
      document.getElementById("avatar").hidden = false;
      document.getElementById("submitform").hidden = false;
    }

    function submitform(e) {
      e.preventDefault();

      const form = new FormData(document.querySelector("#editForm"));
      form.append('apiKey', apiKey);
      form.append('id', id);

      fetch(rootPath + 'controller/edit-contact/', {
        method: 'POST',
        headers: {'Accept': 'application/json, .'},
        body: form
      })
        .then(response => response.text())
        .then(data => {
          if (data == "1") {
            alert("Contact edited.");
            homelink();
          } else {
            alert(data);
            homelink();
          }
        });
    }

    function deleteContact() {
      var confirmDelete = confirm("Delete contact. Are you sure?");
      if (confirmDelete == true) {
        fetch(rootPath + 'controller/delete-contact/?id=' + id)
          .then(response => response.text())
          .then(data => {
            if (data == "1") {
              homelink();
            } else {
              alert(data);
            }
          });
      }
    }
  </script>
</body>
</html>












